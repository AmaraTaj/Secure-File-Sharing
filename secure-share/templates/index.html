<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Secure File Sharing</title>
</head>
<body>
  <h2>üîê Secure File Sharing</h2>

  <!-- Upload -->
  <form id="uploadForm">
    <input type="file" id="fileInput" required />
    <button type="submit">Upload & Encrypt</button>
  </form>
  <p id="uploadStatus"></p>

  <hr>

  <!-- Download -->
  <form id="downloadForm">
    <input type="text" id="downloadFilename" placeholder="Enter original filename (e.g. test.pdf)" required />
    <button type="submit">Decrypt & Download</button>
  </form>
  <p id="downloadStatus"></p>

  <script>
    // Upload
    document.getElementById("uploadForm").onsubmit = async (e) => {
      e.preventDefault();
      const file = document.getElementById("fileInput").files[0];
      if (!file) return;

      const formData = new FormData();
      formData.append("file", file);

      try {
        const res = await fetch("/upload", { method: "POST", body: formData });
        const data = await res.json();
        document.getElementById("uploadStatus").innerText = data.message || data.error;
      } catch {
        document.getElementById("uploadStatus").innerText = "‚ùå Upload failed";
      }
    };

    // Download
    document.getElementById("downloadForm").onsubmit = async (e) => {
      e.preventDefault();
      const filename = document.getElementById("downloadFilename").value.trim();
      if (!filename) return;

      try {
        const res = await fetch(`/download/${filename}`);
        if (!res.ok) {
          const err = await res.json();
          document.getElementById("downloadStatus").innerText = err.error;
          return;
        }

        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
        document.getElementById("downloadStatus").innerText = "‚úÖ File downloaded!";
      } catch {
        document.getElementById("downloadStatus").innerText = "‚ùå Download failed";
      }
    };
  </script>
</body>
</html>
